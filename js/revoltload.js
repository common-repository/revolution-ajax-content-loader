if(jQuery)(function($){var $window=$(window),supported=window.history&&window.history.pushState&&window.history.replaceState,currentURL='',totalStates=0,requestTimer=null;var options={selector:"a",requestKey:"revoltload",requestDelay:0,target:{title:"title",content:"#revoltload"}};var pub={supported:function(){return supported}};var count=1;function _init(opts){$.extend(options,opts||{});options.$body=$("body");options.$container=$(options.container);if(!supported){return}currentURL=window.location.href;$window.on("popstate",_onPop);options.$body.on("click.revoltload",options.selector,_click)}function _click(e){var link=e.currentTarget;if((e.which>1||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey)||(window.location.protocol!==link.protocol||window.location.host!==link.host)){return}if(link.hash&&link.href.replace(link.hash,'')===window.location.href.replace(location.hash,'')||link.href===window.location.href+'#'){return}if(e.target==e.currentTarget){e.preventDefault();e.stopPropagation();if(currentURL==link.href){}else{_request(link.href)}}}function _request(url){$window.trigger("revoltload.request");$.ajax({url:url+((url.indexOf("?")>-1)?"&"+options.requestKey+"=true":"?"+options.requestKey+"=true"),dataType:"json",success:function(response){if(typeof response=="String"){response=$.parseJSON(response)}_render(url,response,0,true)},error:function(response){window.location.href=url}})}function _onPop(e){var data=e.originalEvent.state;if(data!==null&&data.url!==currentURL){$window.trigger("revoltload.request");_render(data.url,data.data,data.scroll,false)}}function _render(url,response,scrollTop,doPush){if(requestTimer!==null){clearTimeout(requestTimer);requestTimer=null}requestTimer=setTimeout(function(){_doRender(url,response,scrollTop,doPush)},options.requestDelay)}function _doRender(url,response,scrollTop,doPush){$window.trigger("revoltload.load");for(var key in options.target){if(response.hasOwnProperty(key)){$(options.target[key]).html((response[key]))}}currentURL=url;$window.trigger("revoltload.render");$window.scrollTop(scrollTop)}function _unescapeHTML(unsafe){return unsafe.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#039;/g,"'")}$.revoltload=function(method){if(pub[method]){return pub[method].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof method==='object'||!method){return _init.apply(this,arguments)}return this}})(jQuery);